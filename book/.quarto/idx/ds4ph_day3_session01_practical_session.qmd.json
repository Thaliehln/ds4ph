{"title":":orange_book: Practical","markdown":{"yaml":{"title":":orange_book: Practical","warning":false},"headingText":"Introduction","containsRefs":false,"markdown":"\n\n\n### Overview\n\nThis tutorial is adapted from the excellent [Machine learning in Python with scikit-learn](https://www.fun-mooc.fr/en/courses/machine-learning-python-scikit-learn/)\n\n### Learning objectives\n\n## Question\n\nWe are interested in predicting **referral in children under 5** based on two of the clinical measurements at the consultation:\n\n-   **age in months** and\n-   **param2**.\n\n```{r}\n#| echo: fenced\nlibrary(tidyverse) # includes dplyr and tibble\nlibrary(skimr)\nlibrary(ggplot2)\nlibrary(DataExplorer)\n```\n\n## Load the data\n\nThe dataset is stored in **dataset1.dta**.\n\nRead the dataset and store it into a dataframe called **df**.\n\nLetâ€™s first load the entire adult dataset containing both numerical and categorical data.\n\n```{r}\n#| echo: fenced\ndf <- openxlsx::read.xlsx(\"./data/dataset3.xlsx\")\n```\n\n## Data exploration\n\nWe want to do some data exploration to get an initial understanding of the data. Before building a predictive model, it is always a good idea to look at the data:\n\n-   maybe the task you are trying to achieve can be solved without machine learning;\n-   you need to check that the information you need for your task is actually present in the dataset;\n-   inspecting the data is a good way to find peculiarities. These can arise during data collection (for example, malfunctioning sensor or missing values), or from the way the data is processed afterwards (for example capped values).\n\n### Variables / features\n\n::: panel-tabset\n#### :pencil2: Exercise 1\n\nExamine the structure of the data, including variable names, labels. \n\n1. How many variables are numerical?\n2. How many features are categorical?\n\n::: callout-tip\n-   Stata: use the [codebook](https://www.stata.com/manuals/dcodebook.pdf) command\n-   R: use the [skim](https://docs.ropensci.org/skimr/reference/skim.html) function from the `skimr` package\n:::\n\nDisplay the variables/features **child_id**, **test** and **test** for the **10 first observations/samples** in the data.\n\n::: callout-tip\n-   Stata hint: use the the combination of `describe` and `list` command to inspect the data\n-   R hint: you need to load the `dplyr` library to use piping\n:::\n\n```{r}\n#| echo: fenced\n# Write your code here\n```\n\n#### R\n\n```{r}\n#| echo: fenced\ndf %>%\n  skimr::skim()\n```\n\n```{r}\n#| echo: fenced\ndf <- df %>%\n  tibble::remove_rownames() %>%\n  tibble::column_to_rownames(var=\"RCT_child_ID\") %>% \n  dplyr::mutate(across(c(RCT_CTX_month,\n                         RCT_CTX_day_of_week,\n                         RCT_SDC_sex, \n                         RCT_CLIN_fever,\n                         RCT_CLIN_cough,\n                         RCT_CLIN_diarrhoea,\n                         RCT_RX_preconsult_antibiotics,\n                         RCT_RX_preconsult_antimalarials,\n                         RCT_CTX_district,\n                         RCT_CTX_area,\n                         RCT_CTX_facility_type,\n                         RCT_TEST_malaria_done,\n                         RCT_TEST_malaria_type,\n                         RCT_TEST_malaria_result,\n                         RCT_DX_malaria,\n                         RCT_DX_malaria_severe,\n                         SPA_CLIN_fever_reported,\n                         SPA_CLIN_fever_investigated,\n                         SPA_CLIN_fever,\n                         RCT_DX_severe,\n                         RCT_RX_antimalarials,\n                         RCT_RX_antimalarial_parenteral,\n                         RCT_RX_ACT,\n                         RCT_RX_AL,\n                         RCT_RX_artemether,\n                         RCT_RX_artesunate,\n                         RCT_RX_primaquine,\n                         RCT_RX_quinine,\n                         RCT_RX_antibiotics,\n                         RCT_RX_antibiotics_src_text,\n                         RCT_MGMT_referral_src_caregiver,\n                         RCT_MGMT_referral_src_registry,\n                         RCT_CTX_SPA_obs,\n                         RCT_CTX_SPA_obs_after_lab,\n                         SPA_MEAS_temperature_done,\n                         SPA_MGMT_admission,\n                         SPA_MGMT_referral_other_facility,\n                         SPA_MGMT_referral_other_provider,\n                         SPA_TEST_malaria_ordered,\n                         SPA_RX_prereferral),\n                       factor))\n```\n\n```{r}\n#| echo: fenced\ndf %>%\n  skimr::skim()\n```\n\n:::\n\nNumerical variables can be naturally handled by machine learning algorithms that are typically composed of a sequence of arithmetic instructions such as additions and multiplications.\n\n```{r}\nDataExplorer::plot_missing(df,\n                           geom_label_args = list(size = 2, label.padding = unit(0.2, \"lines\")))\n```\n\n```{r}\nDataExplorer::plot_bar(df %>% \n                         dplyr::select(-RCT_CTX_facility_ID),\n                       by = \"RCT_CTX_district\")\n```\n\n### Target classes\n\n::: panel-tabset\n\n### :pencil2: Exercise 1\n\nWhat are the different antibiotic treatment classes available in the dataset and how many observations/samples of each types are there?\n\n::: callout-tip\n-   Python: select the right column and use the `value_counts` method.\n:::\n\n```{r}\n#| echo: fenced\n# Write your code here\n```\n\n### R\n\n```{r}\n#| echo: fenced\ndf %>%\n  skimr::skim(RCT_CTX_facility_ID)\n```\n\n:::\n\n## Variable/feature distribution\n\nLet's look at the distribution of individual features, to get some insights about the data. We can start by plotting histograms, note that this only works for features containing numerical values.\n\n::: panel-tabset\n\n### :pencil2: Exercise 2\n\nPlot histograms for the numerical variables/features\n\n```{r}\n#| echo: fenced\n# Write your code here\n```\n\n### R\n\n```{r}\n#| echo: fenced\n# Write your code here\n```\n\n```{r}\nDataExplorer::plot_histogram(df)\n```\n\n:::\n\n::: panel-tabset\n\n### :pencil2: Exercise 3\n\nShow variable/feature distribution for each class.\n\nLooking at these distributions, how difficult do you think it will be to classify the sick children using the `param1` and `param2` variables/features?\n\n```{r}\n#| echo: fenced\n# Write your code here\n```\n\n### R\n\n```{r}\n#| echo: fenced\n# Write your code here\n```\n\n```{r}\n#dummy <- caret::dummyVars(\" ~ .\", data=df)\n```\n\n```{r}\nggplot2::ggplot(data = df, aes(x = RCT_SDC_age_in_months, fill = RCT_TEST_malaria_done)) +\n  geom_histogram(binwidth = 1, alpha = 0.5, position = \"identity\") +\n  theme_minimal()\n```\n```{r}\nggplot2::ggplot(data = df, aes(x = RCT_CLIN_fever_onset, fill = RCT_TEST_malaria_done)) +\n  geom_histogram(binwidth = 1, alpha = 0.5, position = \"identity\") +\n  theme_minimal()\n```\n\n```{r}\nggplot2::ggplot(data = df, aes(x = RCT_CLIN_fever_onset, fill = RCT_TEST_malaria_done)) +\n  geom_histogram(binwidth = 1, alpha = 0.5, position = \"identity\") +\n  theme_minimal()\n```\n\n```{r}\nggplot2::ggplot(data = df, aes(x = RCT_MEAS_temperature, fill = RCT_TEST_malaria_done)) +\n  geom_histogram(binwidth = 0.5, alpha = 0.5, position = \"identity\") +\n  theme_minimal()\n```\n\n:::\n\nThe score of a model will in general depend on the way we make the training / test split. One downside of doing a single split is that it does not give any information about this variability. Another downside, in a setting where the amount of data is small, is that the data available for training and testing will be even smaller after splitting.\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-yaml":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","from":"markdown+emoji","output-file":"ds4ph_day3_session01_practical_session.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.1.251","bibliography":["references.bib"],"csl":"vancouver.csl","theme":"cosmo","title":":orange_book: Practical"},"extensions":{"book":{"multiFile":true}}},"pdf":{"execute":{"fig-width":5.5,"fig-height":3.5,"fig-format":"pdf","fig-dpi":300,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-yaml":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"pdf","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":true,"merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"pdf-engine":"xelatex","standalone":true,"variables":{"graphics":true,"tables":true},"default-image-extension":"pdf","to":"pdf","from":"markdown+emoji","output-file":"ds4ph_day3_session01_practical_session.pdf"},"language":{},"metadata":{"block-headings":true,"bibliography":["references.bib"],"csl":"vancouver.csl","documentclass":"scrreprt","title":":orange_book: Practical"},"extensions":{"book":{}}}}}