{"title":":orange_book: Malaria case study - Comparison of RCT and SPA entries","markdown":{"yaml":{"title":":orange_book: Malaria case study - Comparison of RCT and SPA entries","execute":{"echo":false,"warning":false},"from":"markdown+emoji","toc":true,"number-sections":true},"headingText":"Introduction","containsRefs":false,"markdown":"\n\n\nSensitivity analysis definition\n\nhow SPA observations affect RCT consultations and data recording\n\n``` {{r}}\ninstall.packages(\"ggplot2\")\ninstall.packages(\"ggthemes\")\ninstall.packages(\"networkD3\")\ninstall.packages(\"apyramid\")\n```\n\n```{r}\nlibrary(openxlsx)\nlibrary(dplyr)\nlibrary(skimr)\nlibrary(gtsummary)\nlibrary(finalfit)\nlibrary(ggplot2)\nlibrary(ggthemes)\nlibrary(networkD3) # For alluvial/Sankey diagrams\nlibrary(tidyverse)\n```\n\n### Import the data\n\nData are stored in **dataset2.dta**.\n\n#### :pencil2: Exercise 1 {.unnumbered}\n\n1.  Import the dataset and store it into a dataframe called **df**.\n2.  Select columns **RCT_child_ID**, **RCT_CLIN_fever**, **SPA_CLIN_fever_reported**, **SPA_CLIN_fever_investigated** for the first **10** rows in data frame `df`.\n3.  Display in a table with the following characteristics:\n    a.  Align the content of the first column to the left and the content of the other 3 columns to the centre.\n    b.  Add a caption.\n\n```{r}\n#| df-print: kable\n\n# 1. Import the dataset and store it into a dataframe called **df**. \ndf <- openxlsx::read.xlsx(\"./data/dataset2.xlsx\")\n\ndf %>%\n  # 2. Select columns **child_ID**, **CTX_month**, **CTX_district**, **SDC_age_in_months** for the first **10** rows in data frame `df`.\n  head(10) %>%\n  dplyr::select(RCT_child_ID,\n                RCT_CLIN_fever,\n                SPA_CLIN_fever_reported,\n                SPA_CLIN_fever_investigated) %>%\n  # 3. Display in a table\n  knitr::kable(align = c('l', 'c', 'c', 'c'),\n               caption = \"Extract of the database\")\n```\n### Fever\n\n```{r}\ndf <- df %>%\n  dplyr::mutate(SPA_CLIN_fever_reported_char = ifelse(SPA_CLIN_fever_reported == 1, \"Fever complaint (SPA)\", \"No fever complaint (SPA)\")) %>%\n  dplyr::mutate(SPA_CLIN_fever_investigated_char = ifelse(SPA_CLIN_fever_investigated == 1, \"Fever asked (SPA)\", \"Fever not asked (SPA)\")) %>%\n  dplyr::mutate(SPA_CLIN_fever_char = ifelse(SPA_CLIN_fever == 1, \"Fever (SPA)\", \"No fever (SPA)\")) %>%\n  dplyr::mutate(\n    RCT_CLIN_fever_char = dplyr::case_when(\n      RCT_CLIN_fever == 1 ~ \"Fever (RCT)\",\n      RCT_CLIN_fever == 0 ~ \"No fever (RCT)\",\n      RCT_CLIN_fever == 98 ~ \"Unknown (RCT)\",\n      TRUE ~ \"\"\n    )\n  ) %>%\n  dplyr::mutate(SPA_CLIN_fever_tot_char = ifelse(SPA_CLIN_fever_reported == 1, \"Fever (SPA)\", SPA_CLIN_fever_char)) %>% \n  dplyr::mutate(\n    SPA_CLIN_fever_tot_char = dplyr::case_when(\n      SPA_CLIN_fever_reported == 1 ~ \"Fever (SPA)\",\n      SPA_CLIN_fever_investigated == 1 ~ SPA_CLIN_fever_char,\n      SPA_CLIN_fever_investigated == 0 ~ \"Unknown (SPA)\",\n      TRUE ~ \"\"\n    )\n  )\n```\n\n```{r}\n#| df-print: kable\ntable(df$RCT_CLIN_fever_char, df$SPA_CLIN_fever_reported_char) %>%\n  knitr::kable()\n```\n```{r}\n#| df-print: kable\ntable(df$RCT_CLIN_fever_char, df$SPA_CLIN_fever_tot_char) %>%\n  knitr::kable()\n```\n```{r}\nlong_prop <- data.frame(prop.table(table(rct = df$RCT_CLIN_fever_char, spa= df$SPA_CLIN_fever_tot_char)))\nggplot2::ggplot(data = long_prop)+       # use long data, with proportions as Freq\n  ggplot2::geom_tile(                    # visualize it in tiles\n    aes(\n      x = spa,         # x-axis is case age\n      y = rct,     # y-axis is infector age\n      fill = Freq))+            # color of the tile is the Freq column in the data\n  scale_fill_gradient(          # adjust the fill color of the tiles\n    low = \"white\",\n    high = \"dark green\")+\n  labs(                         # labels\n    x = \"SPA\",\n    y = \"RCT\",\n    title = \"Fever\",\n    subtitle = \"Frequency matrix\",\n    fill = \"Proportion of children\"     # legend title\n  )\n```\n\n::: column-page\n\n```{r}\nlink1 <- df %>%\n  dplyr::filter(SPA_CLIN_fever_reported == 0) %>%\n  select(SPA_CLIN_fever_reported_char, SPA_CLIN_fever_investigated_char) %>%\n  count(SPA_CLIN_fever_reported_char, SPA_CLIN_fever_investigated_char) %>%\n  rename(source = SPA_CLIN_fever_reported_char,\n         target = SPA_CLIN_fever_investigated_char)\n\nlink2 <- df %>%\n  dplyr::filter(SPA_CLIN_fever_investigated == 1) %>% \n  select(SPA_CLIN_fever_investigated_char, SPA_CLIN_fever_char) %>%\n  count(SPA_CLIN_fever_investigated_char, SPA_CLIN_fever_char) %>% \n  rename(source = SPA_CLIN_fever_investigated_char,\n         target = SPA_CLIN_fever_char)\n\nlink3 <- df %>%\n  dplyr::filter(SPA_CLIN_fever_reported == 1) %>% \n  select(SPA_CLIN_fever_reported_char, RCT_CLIN_fever_char) %>%\n  count(SPA_CLIN_fever_reported_char, RCT_CLIN_fever_char) %>% \n  rename(source = SPA_CLIN_fever_reported_char,\n         target = RCT_CLIN_fever_char)\n\nlink4 <- df %>%\n  dplyr::filter(SPA_CLIN_fever_investigated == 0) %>%\n  select(SPA_CLIN_fever_investigated_char, RCT_CLIN_fever_char) %>%\n  count(SPA_CLIN_fever_investigated_char, RCT_CLIN_fever_char) %>% \n  rename(source = SPA_CLIN_fever_investigated_char,\n         target = RCT_CLIN_fever_char)\n\nlink5 <- df %>%\n  dplyr::filter(SPA_CLIN_fever_investigated == 1) %>%\n  select(SPA_CLIN_fever_char, RCT_CLIN_fever_char) %>%\n  count(SPA_CLIN_fever_char, RCT_CLIN_fever_char) %>% \n  rename(source = SPA_CLIN_fever_char,\n         target = RCT_CLIN_fever_char)\n\n# combine links\nlinks <- bind_rows(link1,\n                   link2,\n                   link3,\n                   link4,\n                   link5)\n\n# The unique node names\nnodes <- data.frame(\n  name=c(as.character(links$source), as.character(links$target)) %>% \n    unique()\n  )\n\n# match to numbers, not names\nlinks$IDsource <- match(links$source, nodes$name)-1 \nlinks$IDtarget <- match(links$target, nodes$name)-1\n\np <- sankeyNetwork(\n  Links = links,\n  Nodes = nodes,\n  Source = \"IDsource\",\n  Target = \"IDtarget\",\n  Value = \"n\",\n  NodeID = \"name\",\n  units = \"children\",\n  fontSize = 12,\n  nodeWidth = 30,\n  iterations = 0,\n  sinksRight = FALSE)        # ensure node order is as in data\np\n```\n:::"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":false,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-yaml":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","from":"markdown+emoji","toc":true,"number-sections":true,"output-file":"malaria_case_study_03_report.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.1.251","bibliography":["references.bib"],"csl":"vancouver.csl","theme":"cosmo","title":":orange_book: Malaria case study - Comparison of RCT and SPA entries"},"extensions":{"book":{"multiFile":true}}},"pdf":{"execute":{"fig-width":5.5,"fig-height":3.5,"fig-format":"pdf","fig-dpi":300,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":false,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-yaml":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"pdf","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":true,"merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"pdf-engine":"xelatex","standalone":true,"variables":{"graphics":true,"tables":true},"default-image-extension":"pdf","to":"pdf","from":"markdown+emoji","toc":true,"number-sections":true,"output-file":"malaria_case_study_03_report.pdf"},"language":{},"metadata":{"block-headings":true,"bibliography":["references.bib"],"csl":"vancouver.csl","documentclass":"scrreprt","title":":orange_book: Malaria case study - Comparison of RCT and SPA entries"},"extensions":{"book":{}}}}}