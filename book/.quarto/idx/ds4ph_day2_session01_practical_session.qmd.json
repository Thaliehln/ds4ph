{"title":":orange_book: Malaria case study (1)","markdown":{"yaml":{"title":":orange_book: Malaria case study (1)","warning":false},"headingText":"Introduction","containsRefs":false,"markdown":"\n\n\n### Overview\n\nThese pages will demonstrate use of Quarto with data from Tanzania.\n\n### Learning objectives\n\n## Malaria research questions\n\nResearch questions in an enumerated list\n\n## Getting started\n\n#### Access the datasets\n\nDownload the dataset (Excel) here\n\n#### Access the version of the Quarto template\n\nDownload the final Quarto template used in this case study, to follow-along step-by-step uisng GitHub\n\n#### Quarto resources\n\nReview the R Basics page \"Reading a RMarkdown Script\", or reference these resources: Rmarkdown introduction and Rmarkdown authoring basics.\n\n``` {{r}}\ninstall.packages(\"ggplot2\")\ninstall.packages(\"ggthemes\")\n```\n\n### Dataset description\n\nWe will be using data and examples from a real consultation data which occurred in Tanzania between **start date** and **end date**.\n\nDISCLAIMER: The Ifakara Health Institute has approved the use of this data for training purposes. Please note, that some data has been adapted in order to best achieve training objectives. No personally indentifiable information have been kept in this dataset.\n\nInformation about the consultations of **10,308 children \\[1 day - 59 months\\]** from **18 facilities** (dispensaries and health centres) in **Kaliua** District, **Sengerema** District and **Tanga** District, Tanzania. Data were collected using *ODK* (ODK Collect, ODK Central) between **start date** and **end date**. Data were made available by IHI and Swiss TPH and the Tools for Integrated Management of Childhood Illness (TIMCI) project. Data are stored in **dataset1.dta**.\n\n### Data collection\n\nResearch assistants recorded the following information from different sources.\n\n+-----------+----------------------------------------------------------------------------------------------------------------------------------+\n| Source    | Information                                                                                                                      |\n+===========+==================================================================================================================================+\n| Caregiver | sociodemographic information                                                                                                     |\n|           |                                                                                                                                  |\n|           | information on treatment received before consultation                                                                            |\n|           |                                                                                                                                  |\n|           | -   **clinical presentation** (variables starting with the suffix **CLIN**)                                                      |\n|           | -   laboratory investigations (variables starting with the suffix **TEST**)                                                      |\n|           | -   diagnosis (variables starting with the suffix **DX**)                                                                        |\n|           | -   prescribed medication (variables starting with the suffix **RX**)                                                            |\n+-----------+----------------------------------------------------------------------------------------------------------------------------------+\n| Registry  | referral advice will be extracted from clinical notes and / or facility registers (variables starting with the suffix **MGMT**). |\n+-----------+----------------------------------------------------------------------------------------------------------------------------------+\n\n: Information collected from different sources\n\nResearch assistants sought clarification from healthcare providers only in cases where these variables were not clear from the records.\n\n### Data preparation\n\nData cleaning and data de-identification\n\nPersonally identifiable information (PII) were removed.\n\n### Import the data\n\n::: panel-tabset\n#### :pencil2: Exercise 1\n\nRead the dataset and store it into a dataframe called **df**.\n\n::: callout-tip\nRefer to @sec-import-data-from-files\n:::\n\n```{r}\n#| echo: fenced\n# Write your code here\n```\n\n#### R\n\n```{r}\n#| echo: fenced\nlibrary(haven)\ndf <- haven::read_dta(\"./data/dataset10.dta\")\n```\n\n```{r}\n#| echo: fenced\n#| df-print: kable\nlibrary(dplyr)\ndf %>%\n  head(5) %>%\n  dplyr::select(c(\"child_ID\", \"CONSULT_district\", \"SDC_age_in_month\"))\n```\n:::\n\n## Population characteristics\n\n### Codebook\n\n+-----------------------------+----------------+\n| Variable                    | Coding         |\n+=============================+================+\n| SDC_age_in_month            |                |\n+-----------------------------+----------------+\n| SDC_sex                     | 1: male\\       |\n|                             | 2: female\\     |\n|                             | 98: unknown    |\n+-----------------------------+----------------+\n| CLIN_fever                  | 0: no\\         |\n|                             | 1: yes\\        |\n|                             | 98: not sure   |\n+-----------------------------+----------------+\n| CLIN_fever_onset            |                |\n+-----------------------------+----------------+\n| CLIN_cough                  | 0: no\\         |\n|                             | 1: yes\\        |\n|                             | 98: not sure   |\n+-----------------------------+----------------+\n| CLIN_diarrhoea              | 0: no\\         |\n|                             | 1: yes\\        |\n|                             | 98: not sure   |\n+-----------------------------+----------------+\n| RX_preconsult_antibiotics   |                |\n+-----------------------------+----------------+\n| RX_preconsult_antimalarials |                |\n+-----------------------------+----------------+\n| CONSULT_district            | Kaliua\\        |\n|                             | Sengerema\\     |\n|                             | Tanga          |\n+-----------------------------+----------------+\n| CONSULT_area                | urban\\         |\n|                             | rural          |\n+-----------------------------+----------------+\n| CONSULT_facility_type       | dispensary\\    |\n|                             | health centre  |\n+-----------------------------+----------------+\n\n### Structure of the data\n\n::: panel-tabset\n#### :pencil2: Exercise 2\n\nExamine the structure of the data, including variable names, labels.\n\n::: callout-tip\n-   Stata: use the [codebook](https://www.stata.com/manuals/dcodebook.pdf) command\n-   R: use the [skim](https://docs.ropensci.org/skimr/reference/skim.html) function from the `skimr` package\n:::\n\n```{r}\n#| echo: fenced\n# Write your code here\n```\n\n#### Stata\n\n```{r}\n#| echo: fenced\nlibrary(RStata)\nRStata::stata(\"codebook SDC_age_in_month SDC_sex CLIN_fever CLIN_fever_onset CLIN_diarrhoea CLIN_cough RX_preconsult_antibiotics RX_preconsult_antimalarials CONSULT_district CONSULT_area CONSULT_facility_type\",\n              data.in = df)\n```\n\n#### R\n\n```{r}\n#| echo: fenced\nlibrary(skimr)\ndf %>%\n  skim(SDC_age_in_month,\n       SDC_sex,\n       CLIN_fever,\n       CLIN_fever_onset,\n       CLIN_diarrhoea,\n       CLIN_cough,\n       RX_preconsult_antibiotics,\n       RX_preconsult_antimalarials,\n       CONSULT_district,\n       CONSULT_area,\n       CONSULT_facility_type)\n```\n:::\n\n::: panel-tabset\n#### :pencil2: Exercise 3\n\nCalculate the following two new variables:\n\n+---------------------------+-----------------+\n| Variable                  | Coding          |\n+===========================+=================+\n| SDC_age_category          | \\<2 months\\     |\n|                           | 2-11 months\\    |\n|                           | 12-23 months\\   |\n|                           | 24-35 months\\   |\n|                           | 36-47 months\\   |\n|                           | 48-59 months    |\n+---------------------------+-----------------+\n| CLIN_fever_onset_category | \\<2 days\\       |\n|                           | 2-3 days\\       |\n|                           | 4-6 days\\       |\n|                           | â‰¥7 days         |\n+---------------------------+-----------------+\n\n::: callout-tip\n-   Stata:\n-   R: use the [tbl_summary](https://www.danieldsjoberg.com/gtsummary/reference/tbl_summary.html) function from the `gtsummary` package\n:::\n\n```{r}\n#| echo: fenced\n# Write your code here\n```\n\n#### Stata\n\n```{r}\n#| echo: fenced\nlibrary(RStata)\n```\n\n```{r}\n#| echo: fenced\n\n```\n\n#### R\n\n```{r}\n#| echo: fenced\nlibrary(dplyr)\ndf <- df %>%\n  dplyr::mutate(\n    SDC_age_category = dplyr::case_when(\n      SDC_age_in_month < 2 ~ \"<2 months\",\n      SDC_age_in_month >= 2 & SDC_age_in_month < 12 ~ \"02-11 months\",\n      SDC_age_in_month >= 12 & SDC_age_in_month < 24 ~ \"12-23 months\",\n      SDC_age_in_month >= 24 & SDC_age_in_month < 36 ~ \"24-35 months\",\n      SDC_age_in_month >= 36 & SDC_age_in_month < 48 ~ \"36-47 months\",\n      SDC_age_in_month >= 48 & SDC_age_in_month < 60 ~ \"48-59 months\",\n      TRUE ~ \"\"\n    )\n  ) %>% \n  dplyr::mutate(\n    CLIN_fever_onset_category = dplyr::case_when(\n      CLIN_fever_onset < 2 ~ \"<2 days\",\n      CLIN_fever_onset >= 2 & CLIN_fever_onset < 4 ~ \"2-3 days\",\n      CLIN_fever_onset >= 4 & CLIN_fever_onset < 7 ~ \"4-6 days\",\n      CLIN_fever_onset >= 7 ~ \">= 7 days\",\n      TRUE ~ \"\"\n    )\n  )\n```\n\n#### Python\n:::\n\n::: panel-tabset\n#### :pencil2: Exercise 4\n\nDisplay descriptive statistics for the following population characteristics:\n\n::: callout-tip\n-   Stata\n-   R: use the [tbl_summary](https://www.danieldsjoberg.com/gtsummary/reference/tbl_summary.html) function from the `gtsummary` package\n:::\n\n```{r}\n#| echo: fenced\n# Write your code here\n```\n\n#### Stata\n\n```{r}\n#| echo: fenced\nlibrary(RStata)\n```\n\n```{r}\n#| echo: fenced\ndf$SDC_age_category = as.factor(df$SDC_age_category)\ndf$CLIN_fever_onset_category = as.factor(df$CLIN_fever_onset_category)\n```\n\n```{r}\n#| echo: fenced\nRStata::stata(\"tabulate SDC_sex\",\n              data.in = df)\n```\n\n```{r}\n#| echo: fenced\nRStata::stata(\"tabulate CLIN_fever\",\n              data.in = df)\n```\n\n#### R\n\n```{r}\n#| echo: fenced\nlibrary(gtsummary)\ndf %>%\n  select(SDC_age_category,\n         SDC_sex,\n         CLIN_fever,\n         CLIN_fever_onset_category,\n         CLIN_diarrhoea,\n         CLIN_cough,\n         RX_preconsult_antibiotics,\n         RX_preconsult_antimalarials,\n         CONSULT_district,\n         CONSULT_area,\n         CONSULT_facility_type) %>%\n  tbl_summary()\n```\n:::\n\n#### Identify missing values\n\nIdentify missing values in each variable: missing_plot\n\n```{r}\nlibrary(finalfit)\nexplanatory = c(\"CONSULT_facility_ID\", \"CONSULT_district\", \"CLIN_fever\")\ndependent = \"DX_malaria\"\n\ndf %>% \n  finalfit::missing_pattern(dependent, explanatory)\n```\n\n## Healthcare provider actions\n\n### Codebook\n\n-   Temperature measured\n    -   Fever measured\n-   Fever (temp or history)\n-   Malaria test\n-   Any severe diagnosis\n-   Malaria diagnosis\n-   Malaria treatment\n-   Referral\n\n+-----------------------+-----------------------+-----------------------+\n| Col1                  | Col2                  | Col3                  |\n+=======================+=======================+=======================+\n| MEAS_temperature      | temperature measured  |                       |\n+-----------------------+-----------------------+-----------------------+\n| TEST_malaria_result   | fever                 | 0: negative           |\n|                       |                       |                       |\n|                       |                       | 1: positive           |\n|                       |                       |                       |\n|                       |                       | 2: indeterminate      |\n|                       |                       |                       |\n|                       |                       | 95: unreadable result |\n|                       |                       |                       |\n|                       |                       | 98: not sure          |\n+-----------------------+-----------------------+-----------------------+\n| TEST_malaria_result   | fever                 | 0: negative           |\n|                       |                       |                       |\n|                       |                       | 1: positive           |\n|                       |                       |                       |\n|                       |                       | 2: indeterminate      |\n|                       |                       |                       |\n|                       |                       | 95: unreadable result |\n|                       |                       |                       |\n|                       |                       | 98: not sure          |\n+-----------------------+-----------------------+-----------------------+\n| DX_malaria            | diagnosis of malaria  | 0: no                 |\n|                       |                       |                       |\n|                       |                       | 1: yes                |\n+-----------------------+-----------------------+-----------------------+\n| RX_antimalarials      | malaria treatment     | 0: no                 |\n|                       |                       |                       |\n|                       |                       | 1: yes                |\n+-----------------------+-----------------------+-----------------------+\n\n### Structure of the data\n\n::: panel-tabset\n#### :pencil2: Exercise 5\n\nExamine the structure of the data, including variable names, labels.\n\n::: callout-tip\n-   Stata: use the [codebook](https://www.stata.com/manuals/dcodebook.pdf) command\n-   R: use the [skim](https://docs.ropensci.org/skimr/reference/skim.html) function from the `skimr` package\n:::\n\n```{r}\n#| echo: fenced\n# Write your code here\n```\n\n#### Stata\n\n```{r}\nlibrary(RStata)\nRStata::stata(\"codebook\",\n              data.in = df)\n```\n\n#### R\n\n```{r}\nlibrary(skimr)\ndf %>%\n  skimr::skim(MEAS_temperature,\n              TEST_malaria_result,\n              TEST_malaria_result,\n              DX_malaria,\n              RX_antimalarials)\n```\n:::\n\n::: panel-tabset\n#### :pencil2: Exercise 6\n\nDisplay descriptive statistics for the following healthcare provider actions:\n\n::: callout-tip\n-   R: use the [tbl_summary](https://www.danieldsjoberg.com/gtsummary/reference/tbl_summary.html) function from the `gtsummary` package\n:::\n\n```{r}\n#| echo: fenced\n# Write your code here\n```\n\n#### Stata\n\n#### R\n\n```{r}\n#| echo: fenced\nlibrary(gtsummary)\n\ndf %>%\n  select(MEAS_temperature,\n         TEST_malaria_result,\n         TEST_malaria_result,\n         DX_malaria,\n         RX_antimalarials) %>%\n  tbl_summary()\n```\n:::\n\n## Number of consultations by facility\n\n::: panel-tabset\n### :pencil2: Exercise 6\n\nPlot the number of consultations by facility in bars, grouped by district.\n\n::: callout-tip\n-   Stata:\n-   R:\n:::\n\n### Stata\n\nTo complete\n\n### R\n\n```{r}\n#| echo: fenced\nlibrary(ggplot2)\nlibrary(ggthemes)\n\ndf %>%\n  dplyr::group_by(CONSULT_district,\n                  CONSULT_facility_ID) %>%\n  count() %>% \n  ggplot2::ggplot(aes(x = factor(CONSULT_district),\n                      y = n)) + \n  ggplot2::geom_bar(position = position_dodge2(preserve = \"single\"),\n                    stat=\"identity\") +\n  ggplot2::labs(x = \"\", y = \"No. consultations\") +\n  ggthemes::theme_hc()\n```\n:::\n\n## Data analysis plan\n\nWhich variables from the dataset you plan to use, and what associations between them you will investigate to help answer your research question.\n\nTo discuss comparing things to show that table 2 not as obvious as it seems e.g. temp measurement by reported fever; by facility (also showing 'prevalence' of fever when of whole clinic vs of those who measure to indicate bias), malaria tests of those with history or measured fever, malaria diagnoses vs pos tests vs treatment.\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-yaml":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","from":"markdown+emoji","output-file":"ds4ph_day2_session01_practical_session.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.1.251","bibliography":["references.bib"],"csl":"vancouver.csl","editor":"visual","theme":"cosmo","title":":orange_book: Malaria case study (1)"},"extensions":{"book":{"multiFile":true}}},"pdf":{"execute":{"fig-width":5.5,"fig-height":3.5,"fig-format":"pdf","fig-dpi":300,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-yaml":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"pdf","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":true,"merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"pdf-engine":"xelatex","standalone":true,"variables":{"graphics":true,"tables":true},"default-image-extension":"pdf","to":"pdf","from":"markdown+emoji","output-file":"ds4ph_day2_session01_practical_session.pdf"},"language":{},"metadata":{"block-headings":true,"bibliography":["references.bib"],"csl":"vancouver.csl","editor":"visual","documentclass":"scrreprt","title":":orange_book: Malaria case study (1)"},"extensions":{"book":{}}}}}