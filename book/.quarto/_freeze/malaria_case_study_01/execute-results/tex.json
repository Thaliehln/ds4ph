{
  "hash": "bd4830af4df21f442d76d1c6d1fa67f5",
  "result": {
    "markdown": "---\ntitle: \":orange_book: Malaria case study - Part 1\"\nwarning: false\n---\n\n\n\n## Introduction\n\n### Overview\n\nThese pages will demonstrate how to use Quarto to data from Tanzania.\n\n### Learning objectives\n\n-   Apply what you have learnt on Day 1 on real data\n\n## Getting started\n\n### Access the Quarto template\n\nDownload the Quarto template used for this case study (add link) using GitHub.\n\nPlease review previous sections on Quarto, data import and manipulation.\n\n### Install packages\n\n``` {{r}}\ninstall.packages(\"ggplot2\")\ninstall.packages(\"ggthemes\")\ninstall.packages(\"networkD3\")\ninstall.packages(\"apyramid\")\n```\n\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nlibrary(openxlsx)\nlibrary(tidyverse)\nlibrary(skimr)\nlibrary(DataExplorer)\nlibrary(gtsummary)\nlibrary(finalfit)\nlibrary(ggplot2)\nlibrary(ggthemes)\nlibrary(networkD3) # For alluvial/Sankey diagrams\n```\n````\n:::\n\n\n\n### Import the data\n\n::: panel-tabset\n#### :pencil2: Exercise 1\n\nImport the dataset and store it into a dataframe called **df**. Display the first 5 rows and columns `child_ID`, `CTX_month`, `CTX_district`, `SDC_age_in_months`\n\n::: callout-tip\nRefer to @sec-import-data-from-files\n:::\n\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n# Write your code here\n```\n````\n:::\n\n\n\n#### Stata\n\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nstata_df <- haven::read_dta(\"./data/dataset2.dta\")\n```\n````\n:::\n\n::: {.cell df-print='kable'}\n\n````{.cell-code}\n```{{r}}\n#| df-print: kable\nstata_df %>%\n  head(5) %>%\n  dplyr::select(child_ID,\n                CTX_month,\n                CTX_district,\n                SDC_age_in_months) %>%\n  knitr::kable()\n```\n````\n\n::: {.cell-output-display}\n| child_ID| CTX_month| CTX_district| SDC_age_in_months|\n|--------:|---------:|------------:|-----------------:|\n|        1|         0|            1|                10|\n|        2|         0|            1|                 6|\n|        3|         0|            1|                 6|\n|        4|         0|            1|                11|\n|        5|         1|            1|                21|\n:::\n:::\n\n\n\n#### R\n\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\ndf <- openxlsx::read.xlsx(\"./data/dataset2.xlsx\")\n```\n````\n:::\n\n::: {.cell df-print='kable'}\n\n````{.cell-code}\n```{{r}}\n#| df-print: kable\ndf %>%\n  head(5) %>%\n  dplyr::select(child_ID,\n                CTX_month,\n                CTX_district,\n                SDC_age_in_months) %>%\n  knitr::kable()\n```\n````\n\n::: {.cell-output-display}\n| child_ID| CTX_month|CTX_district | SDC_age_in_months|\n|--------:|---------:|:------------|-----------------:|\n|        1|         7|Kaliua       |                10|\n|        2|         7|Kaliua       |                 6|\n|        3|         7|Kaliua       |                 6|\n|        4|         7|Kaliua       |                11|\n|        5|         8|Kaliua       |                21|\n:::\n:::\n\n\n:::\n\n## Population characteristics\n\n### Codebook\n\n+-----------------------------+---------------+\n| Variable                    | Coding        |\n+=============================+===============+\n| SDC_age_in_months           |               |\n+-----------------------------+---------------+\n| SDC_sex                     | 1: male\\      |\n|                             | 2: female\\    |\n|                             | 98: unknown   |\n+-----------------------------+---------------+\n| CLIN_fever                  | 0: no\\        |\n|                             | 1: yes\\       |\n|                             | 98: not sure  |\n+-----------------------------+---------------+\n| CLIN_fever_onset            |               |\n+-----------------------------+---------------+\n| CLIN_cough                  | 0: no\\        |\n|                             | 1: yes\\       |\n|                             | 98: not sure  |\n+-----------------------------+---------------+\n| CLIN_diarrhoea              | 0: no\\        |\n|                             | 1: yes\\       |\n|                             | 98: not sure  |\n+-----------------------------+---------------+\n| RX_preconsult_antibiotics   |               |\n+-----------------------------+---------------+\n| RX_preconsult_antimalarials |               |\n+-----------------------------+---------------+\n| CTX_district                | Kaliua\\       |\n|                             | Sengerema\\    |\n|                             | Tanga         |\n+-----------------------------+---------------+\n| CTX_area                    | Urban\\        |\n|                             | rural         |\n+-----------------------------+---------------+\n| CTX_facility_type           | Dispensary\\   |\n|                             | Health centre |\n+-----------------------------+---------------+\n\n### Structure of the data\n\n::: panel-tabset\n#### :pencil2: Exercise 2\n\nExamine the structure of the data, including variable names, labels.\n\n::: callout-tip\n-   Stata: use the [codebook](https://www.stata.com/manuals/dcodebook.pdf) command\n-   R: use the [skim](https://docs.ropensci.org/skimr/reference/skim.html) function from the `skimr` package\n:::\n\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n# Write your code here\n```\n````\n:::\n\n\n\n#### Stata\n\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nRStata::stata(\"codebook SDC_age_in_months SDC_sex CLIN_fever CLIN_fever_onset CLIN_diarrhoea CLIN_cough RX_preconsult_antibiotics RX_preconsult_antimalarials CTX_district CTX_area CTX_facility_type\",\n              data.in = stata_df)\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n. codebook SDC_age_in_months SDC_sex CLIN_fever CLIN_fever_onset CLIN_diarrhoea\n>  CLIN_cough RX_preconsult_antibiotics RX_preconsult_antimalarials CTX_distric\n> t CTX_area CTX_facility_type\n\n-------------------------------------------------------------------------------\nSDC_age_in_months                                             SDC_age_in_months\n-------------------------------------------------------------------------------\n\n                  type:  numeric (double)\n\n                 range:  [0,59]                       units:  1\n         unique values:  60                       missing .:  0/10,308\n\n                  mean:   18.7498\n              std. dev:   14.8998\n\n           percentiles:        10%       25%       50%       75%       90%\n                                 3         7        15        27        43\n\n-------------------------------------------------------------------------------\nSDC_sex                                                                 SDC_sex\n-------------------------------------------------------------------------------\n\n                  type:  numeric (double)\n\n                 range:  [0,1]                        units:  1\n         unique values:  2                        missing .:  4/10,308\n\n            tabulation:  Freq.  Value\n                         5,229  0\n                         5,075  1\n                             4  .\n\n-------------------------------------------------------------------------------\nCLIN_fever                                                           CLIN_fever\n-------------------------------------------------------------------------------\n\n                  type:  numeric (double)\n\n                 range:  [0,2]                        units:  1\n         unique values:  3                        missing .:  0/10,308\n\n            tabulation:  Freq.  Value\n                         3,068  0\n                         7,225  1\n                            15  2\n\n-------------------------------------------------------------------------------\nCLIN_fever_onset                                               CLIN_fever_onset\n-------------------------------------------------------------------------------\n\n                  type:  numeric (double)\n\n                 range:  [0,14]                       units:  1\n         unique values:  15                       missing .:  3,083/10,308\n\n                  mean:   2.50145\n              std. dev:   1.93099\n\n           percentiles:        10%       25%       50%       75%       90%\n                                 1         1         2         3         4\n\n-------------------------------------------------------------------------------\nCLIN_diarrhoea                                                   CLIN_diarrhoea\n-------------------------------------------------------------------------------\n\n                  type:  numeric (double)\n\n                 range:  [0,2]                        units:  1\n         unique values:  3                        missing .:  0/10,308\n\n            tabulation:  Freq.  Value\n                         7,982  0\n                         2,306  1\n                            20  2\n\n-------------------------------------------------------------------------------\nCLIN_cough                                                           CLIN_cough\n-------------------------------------------------------------------------------\n\n                  type:  numeric (double)\n\n                 range:  [0,2]                        units:  1\n         unique values:  3                        missing .:  0/10,308\n\n            tabulation:  Freq.  Value\n                         4,658  0\n                         5,635  1\n                            15  2\n\n-------------------------------------------------------------------------------\nRX_preconsult_antibiotics                             RX_preconsult_antibiotics\n-------------------------------------------------------------------------------\n\n                  type:  numeric (double)\n\n                 range:  [0,1]                        units:  1\n         unique values:  2                        missing .:  0/10,308\n\n            tabulation:  Freq.  Value\n                         8,573  0\n                         1,735  1\n\n-------------------------------------------------------------------------------\nRX_preconsult_antimalarials                         RX_preconsult_antimalarials\n-------------------------------------------------------------------------------\n\n                  type:  numeric (double)\n\n                 range:  [0,1]                        units:  1\n         unique values:  2                        missing .:  0/10,308\n\n            tabulation:  Freq.  Value\n                         9,866  0\n                           442  1\n\n-------------------------------------------------------------------------------\nCTX_district                                                       CTX_district\n-------------------------------------------------------------------------------\n\n                  type:  numeric (double)\n\n                 range:  [1,3]                        units:  1\n         unique values:  3                        missing .:  0/10,308\n\n            tabulation:  Freq.  Value\n                         2,429  1\n                         2,703  2\n                         5,176  3\n\n-------------------------------------------------------------------------------\nCTX_area                                                               CTX_area\n-------------------------------------------------------------------------------\n\n                  type:  numeric (double)\n\n                 range:  [1,2]                        units:  1\n         unique values:  2                        missing .:  0/10,308\n\n            tabulation:  Freq.  Value\n                         4,088  1\n                         6,220  2\n\n-------------------------------------------------------------------------------\nCTX_facility_type                                             CTX_facility_type\n-------------------------------------------------------------------------------\n\n                  type:  numeric (double)\n\n                 range:  [1,2]                        units:  1\n         unique values:  2                        missing .:  0/10,308\n\n            tabulation:  Freq.  Value\n                         5,599  1\n                         4,709  2\n```\n:::\n:::\n\n\n\n#### R\n\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\ndf %>%\n  skim(SDC_age_in_months,\n       SDC_sex,\n       CLIN_fever,\n       CLIN_fever_onset,\n       CLIN_diarrhoea,\n       CLIN_cough,\n       RX_preconsult_antibiotics,\n       RX_preconsult_antimalarials,\n       CTX_district,\n       CTX_area,\n       CTX_facility_type)\n```\n````\n\n::: {.cell-output-display}\nTable: Data summary\n\n|                         |           |\n|:------------------------|:----------|\n|Name                     |Piped data |\n|Number of rows           |10308      |\n|Number of columns        |39         |\n|_______________________  |           |\n|Column type frequency:   |           |\n|character                |3          |\n|numeric                  |8          |\n|________________________ |           |\n|Group variables          |None       |\n\n\n**Variable type: character**\n\n|skim_variable     | n_missing| complete_rate| min| max| empty| n_unique| whitespace|\n|:-----------------|---------:|-------------:|---:|---:|-----:|--------:|----------:|\n|CTX_district      |         0|             1|   5|   9|     0|        3|          0|\n|CTX_area          |         0|             1|   5|   5|     0|        2|          0|\n|CTX_facility_type |         0|             1|  10|  13|     0|        2|          0|\n\n\n**Variable type: numeric**\n\n|skim_variable               | n_missing| complete_rate|  mean|    sd| p0| p25| p50| p75| p100|hist                                     |\n|:---------------------------|---------:|-------------:|-----:|-----:|--:|---:|---:|---:|----:|:----------------------------------------|\n|SDC_age_in_months           |         0|           1.0| 18.75| 14.90|  0|   7|  15|  27|   59|▇▆▃▂▁ |\n|SDC_sex                     |         4|           1.0|  1.49|  0.50|  1|   1|   1|   2|    2|▇▁▁▁▇ |\n|CLIN_fever                  |         0|           1.0|  0.84|  3.74|  0|   0|   1|   1|   98|▇▁▁▁▁ |\n|CLIN_fever_onset            |      3083|           0.7|  2.50|  1.93|  0|   1|   2|   3|   14|▇▅▁▁▁ |\n|CLIN_diarrhoea              |         0|           1.0|  0.41|  4.32|  0|   0|   0|   0|   98|▇▁▁▁▁ |\n|CLIN_cough                  |         0|           1.0|  0.69|  3.75|  0|   0|   1|   1|   98|▇▁▁▁▁ |\n|RX_preconsult_antibiotics   |         0|           1.0|  0.17|  0.37|  0|   0|   0|   0|    1|▇▁▁▁▂ |\n|RX_preconsult_antimalarials |         0|           1.0|  0.04|  0.20|  0|   0|   0|   0|    1|▇▁▁▁▁ |\n:::\n:::\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\ndf <- df %>%\n  tibble::remove_rownames() %>%\n  tibble::column_to_rownames(var=\"child_ID\") %>% \n  dplyr::mutate(across(c(SDC_sex, \n                         CLIN_fever,\n                         CLIN_cough,\n                         CLIN_diarrhoea,\n                         RX_preconsult_antibiotics,\n                         RX_preconsult_antimalarials,\n                         CTX_district,\n                         CTX_area,\n                         CTX_facility_type),\n                       factor))\n```\n````\n:::\n\n\n\n:::\n\n#### Identify missing values\n\nIdentify missing values in each variable\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nDataExplorer::plot_missing(df,\n                           geom_label_args = list(size = 2, label.padding = unit(0.2, \"lines\")))\n```\n\n::: {.cell-output-display}\n![](malaria_case_study_01_files/figure-pdf/unnamed-chunk-11-1.pdf){fig-pos='H'}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nDataExplorer::plot_bar(df %>% \n                         dplyr::select(-CTX_facility_ID),\n                       by = \"CTX_district\")\n```\n\n::: {.cell-output-display}\n![](malaria_case_study_01_files/figure-pdf/unnamed-chunk-12-1.pdf){fig-pos='H'}\n:::\n\n::: {.cell-output-display}\n![](malaria_case_study_01_files/figure-pdf/unnamed-chunk-12-2.pdf){fig-pos='H'}\n:::\n\n::: {.cell-output-display}\n![](malaria_case_study_01_files/figure-pdf/unnamed-chunk-12-3.pdf){fig-pos='H'}\n:::\n:::\n\n\n\n::: panel-tabset\n#### :pencil2: Exercise 3\n\nAdd the following two new variables to data frame `df`\n\n+---------------------------+---------------+\n| Variable                  | Coding        |\n+===========================+===============+\n| SDC_age_category          | \\<2 months\\   |\n|                           | 2-11 months\\  |\n|                           | 12-23 months\\ |\n|                           | 24-35 months\\ |\n|                           | 36-47 months\\ |\n|                           | 48-59 months  |\n+---------------------------+---------------+\n| CLIN_fever_onset_category | \\<2 days\\     |\n|                           | 2-3 days\\     |\n|                           | 4-6 days\\     |\n|                           | ≥7 days       |\n+---------------------------+---------------+\n\n::: callout-tip\n-   Stata: use the gen command\n-   R: use the [mutate](https://dplyr.tidyverse.org/reference/mutate.html) and [case_when](https://dplyr.tidyverse.org/reference/case_when.html) functions from the `dplyr` package\n:::\n\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n# Write your code here\n```\n````\n:::\n\n\n\n#### Stata\n\n#### R\n\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\ndf <- df %>%\n  dplyr::mutate(\n    SDC_age_category = dplyr::case_when(\n      SDC_age_in_months < 2 ~ \"<2 months\",\n      SDC_age_in_months >= 2 & SDC_age_in_months < 12 ~ \"02-11 months\",\n      SDC_age_in_months >= 12 & SDC_age_in_months < 24 ~ \"12-23 months\",\n      SDC_age_in_months >= 24 & SDC_age_in_months < 36 ~ \"24-35 months\",\n      SDC_age_in_months >= 36 & SDC_age_in_months < 48 ~ \"36-47 months\",\n      SDC_age_in_months >= 48 & SDC_age_in_months < 60 ~ \"48-59 months\",\n      TRUE ~ \"\"\n    )\n  ) %>% \n  dplyr::mutate(\n    CLIN_fever_onset_category = dplyr::case_when(\n      CLIN_fever_onset < 2 ~ \"<2 days\",\n      CLIN_fever_onset >= 2 & CLIN_fever_onset < 4 ~ \"2-3 days\",\n      CLIN_fever_onset >= 4 & CLIN_fever_onset < 7 ~ \"4-6 days\",\n      CLIN_fever_onset >= 7 ~ \">= 7 days\",\n      TRUE ~ \"\"\n    )\n  )\n```\n````\n:::\n\n\n\n#### Python\n:::\n\n::: panel-tabset\n#### :pencil2: Exercise 4\n\nDisplay descriptive statistics for the following population characteristics:\n\n::: callout-tip\n-   Stata\n-   R: use the [tbl_summary](https://www.danieldsjoberg.com/gtsummary/reference/tbl_summary.html) function from the `gtsummary` package\n:::\n\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n# Write your code here\n```\n````\n:::\n\n\n\n#### Stata\n\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nRStata::stata('tabulate SDC_age_category\n              tabulate SDC_sex\n              tabulate CLIN_fever\n              tabulate CLIN_fever_onset_category\n              tabulate CLIN_diarrhoea\n              tabulate CLIN_cough\n              tabulate RX_preconsult_antibiotics\n              tabulate RX_preconsult_antimalarials\n              tabulate CTX_district\n              tabulate CTX_area\n              tabulate CTX_facility_type',\n              data.in = stata_df)\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n. tabulate SDC_age_category\nvariable SDC_age_category not found\nr(111);\n.               tabulate SDC_sex\n.               tabulate CLIN_fever\n.               tabulate CLIN_fever_onset_category\n.               tabulate CLIN_diarrhoea\n.               tabulate CLIN_cough\n.               tabulate RX_preconsult_antibiotics\n.               tabulate RX_preconsult_antimalarials\n.               tabulate CTX_district\n.               tabulate CTX_area\n.               tabulate CTX_facility_type\n```\n:::\n:::\n\n\n\n#### R\n\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\ndf %>%\n  dplyr::select(SDC_age_category,\n                SDC_sex,\n                CLIN_fever,\n                CLIN_fever_onset_category,\n                CLIN_diarrhoea,\n                CLIN_cough,\n                RX_preconsult_antibiotics,\n                RX_preconsult_antimalarials,\n                CTX_district,\n                CTX_area,\n                CTX_facility_type) %>%\n  gtsummary::tbl_summary(missing_text = \"(Missing)\")\n```\n````\n\n::: {.cell-output-display}\n|**Characteristic**          | **N = 10,308** |\n|:---------------------------|:--------------:|\n|SDC_age_category            |                |\n|<2 months                   |   597 (5.8%)   |\n|02-11 months                |  3,576 (35%)   |\n|12-23 months                |  2,947 (29%)   |\n|24-35 months                |  1,529 (15%)   |\n|36-47 months                |   980 (9.5%)   |\n|48-59 months                |   679 (6.6%)   |\n|SDC_sex                     |                |\n|1                           |  5,229 (51%)   |\n|2                           |  5,075 (49%)   |\n|(Missing)                   |       4        |\n|CLIN_fever                  |                |\n|0                           |  3,068 (30%)   |\n|1                           |  7,225 (70%)   |\n|98                          |   15 (0.1%)    |\n|CLIN_fever_onset_category   |                |\n|                            |  3,083 (30%)   |\n|<2 days                     |  1,998 (19%)   |\n|>= 7 days                   |   343 (3.3%)   |\n|2-3 days                    |  4,386 (43%)   |\n|4-6 days                    |   498 (4.8%)   |\n|CLIN_diarrhoea              |                |\n|0                           |  7,982 (77%)   |\n|1                           |  2,306 (22%)   |\n|98                          |   20 (0.2%)    |\n|CLIN_cough                  |                |\n|0                           |  4,658 (45%)   |\n|1                           |  5,635 (55%)   |\n|98                          |   15 (0.1%)    |\n|RX_preconsult_antibiotics   |                |\n|0                           |  8,573 (83%)   |\n|1                           |  1,735 (17%)   |\n|RX_preconsult_antimalarials |                |\n|0                           |  9,866 (96%)   |\n|1                           |   442 (4.3%)   |\n|CTX_district                |                |\n|Kaliua                      |  2,429 (24%)   |\n|Sengerema                   |  2,703 (26%)   |\n|Tanga                       |  5,176 (50%)   |\n|CTX_area                    |                |\n|rural                       |  4,088 (40%)   |\n|urban                       |  6,220 (60%)   |\n|CTX_facility_type           |                |\n|dispensary                  |  5,599 (54%)   |\n|health center               |  4,709 (46%)   |\n:::\n:::\n\n\n:::\n\n## Healthcare provider actions\n\n### Codebook\n\n-   Temperature measured\n    -   Fever measured\n-   Fever (temp or history)\n-   Malaria test\n-   Any severe diagnosis\n-   Malaria diagnosis\n-   Malaria treatment\n-   Referral\n\n+-----------------------------+------------------------+\n| Variable                    | Coding                 |\n+=============================+========================+\n| MEAS_temperature            |                        |\n+-----------------------------+------------------------+\n|                             |                        |\n+-----------------------------+------------------------+\n| TEST_malaria_result         | 0: negative\\           |\n|                             | 1: positive\\           |\n|                             | 2: indeterminate\\      |\n|                             | 95: unreadable result\\ |\n|                             | 98: not sure           |\n+-----------------------------+------------------------+\n| DX_malaria                  | 0: no\\                 |\n|                             | 1: yes                 |\n+-----------------------------+------------------------+\n| RX_antimalarials            | 0: no\\                 |\n|                             | 1: yes                 |\n+-----------------------------+------------------------+\n| MGMT_referral_src_caregiver |                        |\n+-----------------------------+------------------------+\n| MGMT_referral_src_registry  |                        |\n+-----------------------------+------------------------+\n\n### Structure of the data\n\n::: panel-tabset\n#### :pencil2: Exercise 5\n\nExamine the structure of the data, including variable names, labels.\n\n::: callout-tip\n-   Stata: use the [codebook](https://www.stata.com/manuals/dcodebook.pdf) command\n-   R: use the [skim](https://docs.ropensci.org/skimr/reference/skim.html) function from the `skimr` package\n:::\n\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n# Write your code here\n```\n````\n:::\n\n\n\n#### Stata\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nRStata::stata(\"codebook MEAS_temperature TEST_malaria_result TEST_malaria_result DX_malaria RX_antimalarials MGMT_referral_src_caregiver MGMT_referral_src_registry\",\n              data.in = stata_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n. codebook MEAS_temperature TEST_malaria_result TEST_malaria_result DX_malaria \n> RX_antimalarials MGMT_referral_src_caregiver MGMT_referral_src_registry\n\n-------------------------------------------------------------------------------\nMEAS_temperature                                               MEAS_temperature\n-------------------------------------------------------------------------------\n\n                  type:  numeric (double)\n\n                 range:  [34.5,42.5]                  units:  .1\n         unique values:  16                       missing .:  9,271/10,308\n\n                  mean:   37.0781\n              std. dev:   .977139\n\n           percentiles:        10%       25%       50%       75%       90%\n                                36      36.5        37      37.5      38.5\n\n-------------------------------------------------------------------------------\nTEST_malaria_result                                         TEST_malaria_result\n-------------------------------------------------------------------------------\n\n                  type:  numeric (double)\n\n                 range:  [0,98]                       units:  1\n         unique values:  5                        missing .:  4,550/10,308\n\n            tabulation:  Freq.  Value\n                         4,665  0\n                         1,032  1\n                             1  2\n                             3  95\n                            57  98\n                         4,550  .\n\n-------------------------------------------------------------------------------\nTEST_malaria_result                                         TEST_malaria_result\n-------------------------------------------------------------------------------\n\n                  type:  numeric (double)\n\n                 range:  [0,98]                       units:  1\n         unique values:  5                        missing .:  4,550/10,308\n\n            tabulation:  Freq.  Value\n                         4,665  0\n                         1,032  1\n                             1  2\n                             3  95\n                            57  98\n                         4,550  .\n\n-------------------------------------------------------------------------------\nDX_malaria                                                           DX_malaria\n-------------------------------------------------------------------------------\n\n                  type:  numeric (double)\n\n                 range:  [0,1]                        units:  1\n         unique values:  2                        missing .:  0/10,308\n\n            tabulation:  Freq.  Value\n                         8,508  0\n                         1,800  1\n\n-------------------------------------------------------------------------------\nRX_antimalarials                                               RX_antimalarials\n-------------------------------------------------------------------------------\n\n                  type:  numeric (double)\n\n                 range:  [0,1]                        units:  1\n         unique values:  2                        missing .:  0/10,308\n\n            tabulation:  Freq.  Value\n                         9,018  0\n                         1,290  1\n\n-------------------------------------------------------------------------------\nMGMT_referral_src_caregiver                         MGMT_referral_src_caregiver\n-------------------------------------------------------------------------------\n\n                  type:  numeric (double)\n\n                 range:  [0,98]                       units:  1\n         unique values:  4                        missing .:  0/10,308\n\n            tabulation:  Freq.  Value\n                        10,122  0\n                           164  1\n                             9  97\n                            13  98\n\n-------------------------------------------------------------------------------\nMGMT_referral_src_registry                           MGMT_referral_src_registry\n-------------------------------------------------------------------------------\n\n                  type:  numeric (double)\n\n                 range:  [0,1]                        units:  1\n         unique values:  2                        missing .:  0/10,308\n\n            tabulation:  Freq.  Value\n                        10,194  0\n                           114  1\n```\n:::\n:::\n\n\n\n#### R\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf %>%\n  skimr::skim(MEAS_temperature,\n              TEST_malaria_result,\n              TEST_malaria_result,\n              DX_malaria,\n              RX_antimalarials,\n              MGMT_referral_src_caregiver,\n              MGMT_referral_src_registry)\n```\n\n::: {.cell-output-display}\nTable: Data summary\n\n|                         |           |\n|:------------------------|:----------|\n|Name                     |Piped data |\n|Number of rows           |10308      |\n|Number of columns        |40         |\n|_______________________  |           |\n|Column type frequency:   |           |\n|numeric                  |6          |\n|________________________ |           |\n|Group variables          |None       |\n\n\n**Variable type: numeric**\n\n|skim_variable               | n_missing| complete_rate|  mean|   sd|   p0|  p25| p50|  p75| p100|hist                                     |\n|:---------------------------|---------:|-------------:|-----:|----:|----:|----:|---:|----:|----:|:----------------------------------------|\n|MEAS_temperature            |      9271|          0.10| 37.08| 0.98| 34.5| 36.5|  37| 37.5| 42.5|▃▇▃▁▁ |\n|TEST_malaria_result         |      4550|          0.56|  1.20| 9.93|  0.0|  0.0|   0|  0.0| 98.0|▇▁▁▁▁ |\n|DX_malaria                  |         0|          1.00|  0.17| 0.38|  0.0|  0.0|   0|  0.0|  1.0|▇▁▁▁▂ |\n|RX_antimalarials            |         0|          1.00|  0.13| 0.33|  0.0|  0.0|   0|  0.0|  1.0|▇▁▁▁▁ |\n|MGMT_referral_src_caregiver |         0|          1.00|  0.22| 4.50|  0.0|  0.0|   0|  0.0| 98.0|▇▁▁▁▁ |\n|MGMT_referral_src_registry  |         0|          1.00|  0.01| 0.10|  0.0|  0.0|   0|  0.0|  1.0|▇▁▁▁▁ |\n:::\n:::\n\n\n:::\n\n::: panel-tabset\n#### :pencil2: Exercise 3\n\nAdd the following two new variables to data frame `df`\n\n-   MEAS_fever\n-   Fever (temp or history)\n\n::: callout-tip\n-   Stata: use the gen command\n-   R: use the mutate function from the `dplyr` package\n:::\n\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n# Write your code here\n```\n````\n:::\n\n\n\n#### Stata\n\n#### R\n\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\ndf <- df %>%\n  dplyr::mutate(CALC_temperature_measured = !is.na(MEAS_temperature)) %>%\n  dplyr::mutate(CALC_fever = MEAS_temperature >= 37.5) %>%\n  dplyr::mutate(CALC_fever_or_temp = (CLIN_fever == 1) | (CALC_fever == 1))\n```\n````\n:::\n\n\n\n#### Python\n:::\n\n::: panel-tabset\n#### :pencil2: Exercise 6\n\nDisplay descriptive statistics for the following healthcare provider actions:\n\n::: callout-tip\n-   R: use the [tbl_summary](https://www.danieldsjoberg.com/gtsummary/reference/tbl_summary.html) function from the `gtsummary` package\n:::\n\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n# Write your code here\n```\n````\n:::\n\n\n\n#### Stata\n\n#### R\n\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\ndf %>%\n  dplyr::select(CALC_temperature_measured,\n                CALC_fever,\n                CALC_fever_or_temp,\n                TEST_malaria_result,\n                TEST_malaria_result,\n                DX_malaria,\n                RX_antimalarials,\n                MGMT_referral_src_caregiver,\n                MGMT_referral_src_registry) %>%\n  gtsummary::tbl_summary(missing_text = \"(Missing)\")\n```\n````\n\n::: {.cell-output-display}\n|**Characteristic**          | **N = 10,308** |\n|:---------------------------|:--------------:|\n|CALC_temperature_measured   |  1,037 (10%)   |\n|CALC_fever                  |   326 (31%)    |\n|(Missing)                   |     9,271      |\n|CALC_fever_or_temp          |  7,252 (97%)   |\n|(Missing)                   |     2,842      |\n|TEST_malaria_result         |                |\n|0                           |  4,665 (81%)   |\n|1                           |  1,032 (18%)   |\n|2                           |   1 (<0.1%)    |\n|95                          |   3 (<0.1%)    |\n|98                          |   57 (1.0%)    |\n|(Missing)                   |     4,550      |\n|DX_malaria                  |  1,800 (17%)   |\n|RX_antimalarials            |  1,290 (13%)   |\n|MGMT_referral_src_caregiver |                |\n|0                           |  10,122 (98%)  |\n|1                           |   164 (1.6%)   |\n|97                          |   9 (<0.1%)    |\n|98                          |   13 (0.1%)    |\n|MGMT_referral_src_registry  |   114 (1.1%)   |\n:::\n:::\n\n\n:::\n\n## Number of consultations by facility\n\n::: panel-tabset\n### :pencil2: Exercise 6\n\nPlot the number of consultations by facility in bars, grouped by district.\n\n::: callout-tip\n-   Stata:\n-   R:\n:::\n\n### Stata\n\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nstata_cmd <- '\ngraph bar (count) child_ID, over(CTX_facility_ID, axis(off)) over(CTX_district, relabel(1 \"Kaliua\" 2 \"Sengerema\" 3 \"Tanga\")) nofill ytitle(No. consultations) title(No. consultations by facility)\ngraph export ./images/day02_stata_plot.png, replace\n'\nRStata::stata(stata_cmd,\n              data.in = stata_df)\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n. \n. graph bar (count) child_ID, over(CTX_facility_ID, axis(off)) over(CTX_distric\n> t, relabel(1 \"Kaliua\" 2 \"Sengerema\" 3 \"Tanga\")) nofill ytitle(No. consultatio\n> ns) title(No. consultations by facility)\n. graph export ./images/day02_stata_plot.png, replace\n(file ./images/day02_stata_plot.png written in PNG format)\n```\n:::\n:::\n\n\n\n![](images/day02_stata_plot.png)\n\n### R\n\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\ndf %>%\n  dplyr::group_by(CTX_district,\n                  CTX_facility_ID) %>%\n  count() %>% \n  ggplot2::ggplot(aes(x = haven::as_factor(CTX_district),\n                      y = n)) + \n  ggplot2::geom_bar(position = position_dodge2(preserve = \"single\"),\n                    stat=\"identity\") +\n  ggplot2::labs(x = \"\", y = \"No. consultations\") +\n  ggthemes::theme_hc()\n```\n````\n\n::: {.cell-output-display}\n![](malaria_case_study_01_files/figure-pdf/unnamed-chunk-26-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n:::\n\n## Fever assessment\n\n-   temp measurement by reported fever; by facility\n\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n# Write here\n```\n````\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nchisq.test(df$CLIN_fever, df$TEST_malaria_result)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tPearson's Chi-squared test\n\ndata:  df$CLIN_fever and df$TEST_malaria_result\nX-squared = 61.449, df = 8, p-value = 2.42e-10\n```\n:::\n:::\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\ndf$CTX_facility_ID <- haven::as_factor(df$CTX_facility_ID) \ndf %>%\n  dplyr::filter(CLIN_fever == 1) %>%\n  dplyr::select(MEAS_temperature,\n                CTX_facility_ID) %>%\n  gtsummary::tbl_summary(by = CTX_facility_ID) %>%\n  add_p()\n```\n````\n\n::: {.cell-output-display}\n|**Characteristic** |  **F8529**, N = 186  | **F8195**, N = 581 |  **F8793**, N = 780  |  **F7729**, N = 197  |  **F4848**, N = 406  |  **F8444**, N = 209  |  **F9109**, N = 358  |  **F8379**, N = 465  |  **F5145**, N = 490  |  **F6552**, N = 291  |  **F4024**, N = 550  |  **F3366**, N = 603  |  **F7327**, N = 270  |  **F4056**, N = 62   |  **F5560**, N = 356  |  **F6813**, N = 323  |  **F0542**, N = 682  |  **F5656**, N = 416  | **p-value** |\n|:------------------|:--------------------:|:------------------:|:--------------------:|:--------------------:|:--------------------:|:--------------------:|:--------------------:|:--------------------:|:--------------------:|:--------------------:|:--------------------:|:--------------------:|:--------------------:|:--------------------:|:--------------------:|:--------------------:|:--------------------:|:--------------------:|:-----------:|\n|MEAS_temperature   | 37.50 (37.00, 38.00) |    NA (NA, NA)     | 39.50 (39.25, 39.75) | 37.00 (36.25, 37.50) | 36.50 (36.00, 36.88) | 37.00 (37.00, 37.00) | 38.50 (37.00, 38.50) | 37.50 (36.50, 38.25) | 37.50 (37.00, 38.75) | 37.00 (37.00, 38.00) | 37.00 (37.00, 37.50) | 38.00 (38.00, 38.50) | 38.25 (38.12, 38.38) | 39.00 (38.25, 39.50) | 37.00 (36.50, 38.00) | 37.00 (36.50, 37.50) | 37.50 (36.88, 37.75) | 36.25 (36.00, 37.00) |   <0.001    |\n|Unknown            |         136          |        581         |         778          |          70          |         380          |         203          |         333          |         422          |         479          |         117          |         531          |         598          |         268          |          59          |         222          |         184          |         670          |         398          |             |\n:::\n:::\n\n\n\n-   also showing 'prevalence' of fever when of whole clinic vs of those who measure to indicate bias\n\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n# Write here\n```\n````\n:::\n\n\n\n## Malaria tests\n\n-   malaria tests of those with history or measured fever\n\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n# Write here\n```\n````\n:::\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\ntable(df$CALC_fever_or_temp, df$TEST_malaria_result)\n```\n````\n\n::: {.cell-output .cell-output-stdout}\n```\n       \n           0    1    2   95   98\n  FALSE   70    2    0    1    1\n  TRUE  3952  966    1    2   47\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nchisq.test(df$CALC_fever_or_temp, df$TEST_malaria_result)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tPearson's Chi-squared test\n\ndata:  df$CALC_fever_or_temp and df$TEST_malaria_result\nX-squared = 33.92, df = 4, p-value = 7.74e-07\n```\n:::\n:::\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\ndf$CTX_facility_ID <- haven::as_factor(df$CTX_facility_ID) \ndf %>%\n  dplyr::filter(CALC_fever_or_temp == 1) %>%\n  dplyr::select(TEST_malaria_result,\n                CTX_facility_ID) %>%\n  gtsummary::tbl_summary(by = CTX_facility_ID)\n```\n````\n\n::: {.cell-output-display}\n|**Characteristic**  | **F8529**, N = 190 | **F8195**, N = 581 | **F8793**, N = 780 | **F7729**, N = 197 | **F4848**, N = 406 | **F8444**, N = 209 | **F9109**, N = 358 | **F8379**, N = 467 | **F5145**, N = 491 | **F6552**, N = 301 | **F4024**, N = 550 | **F3366**, N = 603 | **F7327**, N = 270 | **F4056**, N = 62 | **F5560**, N = 358 | **F6813**, N = 330 | **F0542**, N = 683 | **F5656**, N = 416 |\n|:-------------------|:------------------:|:------------------:|:------------------:|:------------------:|:------------------:|:------------------:|:------------------:|:------------------:|:------------------:|:------------------:|:------------------:|:------------------:|:------------------:|:-----------------:|:------------------:|:------------------:|:------------------:|:------------------:|\n|TEST_malaria_result |                    |                    |                    |                    |                    |                    |                    |                    |                    |                    |                    |                    |                    |                   |                    |                    |                    |                    |\n|0                   |      83 (67%)      |     151 (33%)      |     319 (54%)      |     125 (82%)      |     285 (75%)      |     135 (98%)      |     159 (95%)      |     371 (93%)      |     226 (95%)      |     213 (96%)      |     221 (97%)      |     346 (97%)      |      21 (25%)      |     32 (57%)      |     242 (92%)      |     225 (91%)      |     511 (90%)      |     287 (97%)      |\n|1                   |      38 (31%)      |     300 (66%)      |     270 (46%)      |      28 (18%)      |      95 (25%)      |       0 (0%)       |      2 (1.2%)      |     25 (6.3%)      |      7 (2.9%)      |      4 (1.8%)      |      6 (2.6%)      |      6 (1.7%)      |      59 (69%)      |     20 (36%)      |     20 (7.6%)      |     21 (8.5%)      |     55 (9.7%)      |     10 (3.4%)      |\n|2                   |       0 (0%)       |       0 (0%)       |      1 (0.2%)      |       0 (0%)       |       0 (0%)       |       0 (0%)       |       0 (0%)       |       0 (0%)       |       0 (0%)       |       0 (0%)       |       0 (0%)       |       0 (0%)       |       0 (0%)       |      0 (0%)       |       0 (0%)       |       0 (0%)       |       0 (0%)       |       0 (0%)       |\n|95                  |      1 (0.8%)      |       0 (0%)       |      1 (0.2%)      |       0 (0%)       |       0 (0%)       |       0 (0%)       |       0 (0%)       |       0 (0%)       |       0 (0%)       |       0 (0%)       |       0 (0%)       |       0 (0%)       |       0 (0%)       |      0 (0%)       |       0 (0%)       |       0 (0%)       |       0 (0%)       |       0 (0%)       |\n|98                  |      2 (1.6%)      |      5 (1.1%)      |      1 (0.2%)      |       0 (0%)       |       0 (0%)       |      3 (2.2%)      |      6 (3.6%)      |      2 (0.5%)      |      6 (2.5%)      |      6 (2.7%)      |       0 (0%)       |      3 (0.8%)      |      5 (5.9%)      |     4 (7.1%)      |       0 (0%)       |      1 (0.4%)      |      3 (0.5%)      |       0 (0%)       |\n|Unknown             |         66         |        125         |        188         |         44         |         26         |         71         |        191         |         69         |        252         |         78         |        323         |        248         |        185         |         6         |         96         |         83         |        114         |        119         |\n:::\n:::\n\n\n\n## Malaria treatments\n\n-   malaria diagnoses vs. positive tests vs. treatment.\n\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n# Write here\n```\n````\n:::\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\ndf <- df %>%\n  dplyr::mutate(TEST_malaria_positive = 1* (TEST_malaria_result == 1))\ntable(df$TEST_malaria_result, df$DX_malaria, df$RX_antimalarials) %>% knitr::kable()\n```\n````\n\n::: {.cell-output-display}\n|Var1 |Var2 |Var3 | Freq|\n|:----|:----|:----|----:|\n|0    |0    |0    | 3890|\n|1    |0    |0    |   15|\n|2    |0    |0    |    1|\n|95   |0    |0    |    2|\n|98   |0    |0    |   31|\n|0    |1    |0    |  645|\n|1    |1    |0    |   49|\n|2    |1    |0    |    0|\n|95   |1    |0    |    1|\n|98   |1    |0    |   17|\n|0    |0    |1    |   99|\n|1    |0    |1    |   50|\n|2    |0    |1    |    0|\n|95   |0    |1    |    0|\n|98   |0    |1    |    2|\n|0    |1    |1    |   31|\n|1    |1    |1    |  918|\n|2    |1    |1    |    0|\n|95   |1    |1    |    0|\n|98   |1    |1    |    7|\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nchisq.test(df$TEST_malaria_result, df$DX_malaria)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tPearson's Chi-squared test\n\ndata:  df$TEST_malaria_result and df$DX_malaria\nX-squared = 2582, df = 4, p-value < 2.2e-16\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nchisq.test(df$TEST_malaria_result, df$RX_antimalarials)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tPearson's Chi-squared test\n\ndata:  df$TEST_malaria_result and df$RX_antimalarials\nX-squared = 4508.8, df = 4, p-value < 2.2e-16\n```\n:::\n:::\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n# df$CTX_facility_ID <- haven::as_factor(df$CTX_facility_ID) \n# df %>%\n#   dplyr::filter(TEST_malaria_positive == 1) %>%\n#   dplyr::select(DX_malaria,\n#                 RX_antimalarials,\n#                 CTX_facility_ID) %>%\n#   gtsummary::tbl_summary(by = CTX_facility_ID)\n```\n````\n:::\n",
    "supporting": [
      "malaria_case_study_01_files\\figure-pdf"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{},\"value\":[]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}