{
  "hash": "d7b77f4a8cb076968520b481c0e228ad",
  "result": {
    "markdown": "---\ntitle: \":orange_book: Encode categorical data\"\nexecute: \n  echo: true\n  warning: false\n---\n\n\n\n# Introduction\n\n## Overview\n\nMost ML algorithms only work with numeric values\nIn this notebook, we will present typical ways of dealing with categorical variables by encoding them, namely ordinal encoding and one-hot encoding.\n\n## Learning objectives\n\n* seen two common strategies for encoding categorical features: ordinal encoding and one-hot encoding;\n* used a pipeline to use a one-hot encoder before fitting a logistic regression.\n\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\nlibrary(dplyr)\nlibrary(skimr)\n```\n````\n:::\n\n\n\n## Identify categorical data\n\nLet’s first load the entire adult dataset containing both numerical and categorical data.\n\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\ndf <- openxlsx::read.xlsx(\"./data/dataset2.xlsx\")\n```\n````\n:::\n\n\n\n::: panel-tabset\n#### :pencil2: Exercise 1\n\nExamine the structure of the data, including variable names, labels.\n\n::: callout-tip\n-   Stata: use the [codebook](https://www.stata.com/manuals/dcodebook.pdf) command\n-   R: use the [skim](https://docs.ropensci.org/skimr/reference/skim.html) function from the `skimr` package\n:::\n\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n# Write your code here\n```\n````\n:::\n\n\n\n#### R\n\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\ndf %>%\n  skimr::skim()\n```\n````\n\n::: {.cell-output-display}\nTable: Data summary\n\n|                         |           |\n|:------------------------|:----------|\n|Name                     |Piped data |\n|Number of rows           |10308      |\n|Number of columns        |39         |\n|_______________________  |           |\n|Column type frequency:   |           |\n|character                |5          |\n|numeric                  |34         |\n|________________________ |           |\n|Group variables          |None       |\n\n\n**Variable type: character**\n\n|skim_variable     | n_missing| complete_rate| min| max| empty| n_unique| whitespace|\n|:-----------------|---------:|-------------:|---:|---:|-----:|--------:|----------:|\n|CTX_district      |         0|           1.0|   5|   9|     0|        3|          0|\n|CTX_facility_ID   |         0|           1.0|   5|   5|     0|       18|          0|\n|CTX_area          |         0|           1.0|   5|   5|     0|        2|          0|\n|CTX_facility_type |         0|           1.0|  10|  13|     0|        2|          0|\n|RX_free_text      |      9279|           0.1|   3| 220|     0|      729|          0|\n\n\n**Variable type: numeric**\n\n|skim_variable               | n_missing| complete_rate|    mean|      sd|   p0|     p25|    p50|     p75|    p100|hist  |\n|:---------------------------|---------:|-------------:|-------:|-------:|----:|-------:|------:|-------:|-------:|:-----|\n|child_ID                    |         0|          1.00| 5154.50| 2975.81|  1.0| 2577.75| 5154.5| 7731.25| 10308.0|▇▇▇▇▇ |\n|CTX_month                   |         0|          1.00|    9.81|    1.28|  7.0|    9.00|   10.0|   11.00|    12.0|▆▇▇▇▃ |\n|CTX_day_of_week             |         0|          1.00|    1.88|    1.47|  0.0|    0.00|    2.0|    3.00|     6.0|▇▃▃▃▁ |\n|SDC_sex                     |         4|          1.00|    1.49|    0.50|  1.0|    1.00|    1.0|    2.00|     2.0|▇▁▁▁▇ |\n|SDC_age_in_months           |         0|          1.00|   18.75|   14.90|  0.0|    7.00|   15.0|   27.00|    59.0|▇▆▃▂▁ |\n|CLIN_fever                  |         0|          1.00|    0.84|    3.74|  0.0|    0.00|    1.0|    1.00|    98.0|▇▁▁▁▁ |\n|CLIN_fever_onset            |      3083|          0.70|    2.50|    1.93|  0.0|    1.00|    2.0|    3.00|    14.0|▇▅▁▁▁ |\n|CLIN_cough                  |         0|          1.00|    0.69|    3.75|  0.0|    0.00|    1.0|    1.00|    98.0|▇▁▁▁▁ |\n|CLIN_diarrhoea              |         0|          1.00|    0.41|    4.32|  0.0|    0.00|    0.0|    0.00|    98.0|▇▁▁▁▁ |\n|MEAS_temperature            |      9271|          0.10|   37.08|    0.98| 34.5|   36.50|   37.0|   37.50|    42.5|▃▇▃▁▁ |\n|TEST_malaria_done           |         0|          1.00|    0.56|    0.50|  0.0|    0.00|    1.0|    1.00|     1.0|▆▁▁▁▇ |\n|TEST_malaria_type           |      4550|          0.56|    1.85|    8.72|  1.0|    1.00|    1.0|    1.00|    98.0|▇▁▁▁▁ |\n|TEST_malaria_result         |      4550|          0.56|    1.20|    9.93|  0.0|    0.00|    0.0|    0.00|    98.0|▇▁▁▁▁ |\n|DX_malaria                  |         0|          1.00|    0.17|    0.38|  0.0|    0.00|    0.0|    0.00|     1.0|▇▁▁▁▂ |\n|DX_malaria_severe           |         0|          1.00|    0.01|    0.12|  0.0|    0.00|    0.0|    0.00|     1.0|▇▁▁▁▁ |\n|DX_count_non_malaria        |         0|          1.00|    0.84|    0.71|  0.0|    0.00|    1.0|    1.00|     5.0|▇▁▁▁▁ |\n|DX_severe                   |         0|          1.00|    0.02|    0.16|  0.0|    0.00|    0.0|    0.00|     1.0|▇▁▁▁▁ |\n|RX_preconsult_antibiotics   |         0|          1.00|    0.17|    0.37|  0.0|    0.00|    0.0|    0.00|     1.0|▇▁▁▁▂ |\n|RX_preconsult_antimalarials |         0|          1.00|    0.04|    0.20|  0.0|    0.00|    0.0|    0.00|     1.0|▇▁▁▁▁ |\n|RX_antimalarials            |         0|          1.00|    0.13|    0.33|  0.0|    0.00|    0.0|    0.00|     1.0|▇▁▁▁▁ |\n|RX_antimalarial_parenteral  |         0|          1.00|    0.02|    0.15|  0.0|    0.00|    0.0|    0.00|     1.0|▇▁▁▁▁ |\n|RX_ACT                      |         0|          1.00|    0.01|    0.08|  0.0|    0.00|    0.0|    0.00|     1.0|▇▁▁▁▁ |\n|RX_AL                       |         0|          1.00|    0.12|    0.32|  0.0|    0.00|    0.0|    0.00|     1.0|▇▁▁▁▁ |\n|RX_artemether               |         0|          1.00|    0.01|    0.08|  0.0|    0.00|    0.0|    0.00|     1.0|▇▁▁▁▁ |\n|RX_artesunate               |         0|          1.00|    0.02|    0.15|  0.0|    0.00|    0.0|    0.00|     1.0|▇▁▁▁▁ |\n|RX_primaquine               |         0|          1.00|    0.00|    0.05|  0.0|    0.00|    0.0|    0.00|     1.0|▇▁▁▁▁ |\n|RX_quinine                  |         0|          1.00|    0.01|    0.08|  0.0|    0.00|    0.0|    0.00|     1.0|▇▁▁▁▁ |\n|RX_antibiotics              |         0|          1.00|    0.53|    0.50|  0.0|    0.00|    1.0|    1.00|     1.0|▇▁▁▁▇ |\n|RX_antibiotics_src_text     |         0|          1.00|    0.01|    0.10|  0.0|    0.00|    0.0|    0.00|     1.0|▇▁▁▁▁ |\n|RX_count_other              |         0|          1.00|    1.49|    1.30|  0.0|    1.00|    1.0|    2.00|    16.0|▇▁▁▁▁ |\n|MGMT_referral_src_caregiver |         0|          1.00|    0.22|    4.50|  0.0|    0.00|    0.0|    0.00|    98.0|▇▁▁▁▁ |\n|MGMT_referral_src_registry  |         0|          1.00|    0.01|    0.10|  0.0|    0.00|    0.0|    0.00|     1.0|▇▁▁▁▁ |\n|CTX_SPA_obs                 |         0|          1.00|    0.06|    0.23|  0.0|    0.00|    0.0|    0.00|     1.0|▇▁▁▁▁ |\n|CTX_SPA_obs_after_lab       |         0|          1.00|    0.01|    0.08|  0.0|    0.00|    0.0|    0.00|     1.0|▇▁▁▁▁ |\n:::\n:::\n\n\n:::\n\n## Ordinal encoding\n\nThe most intuitive strategy is to encode each category with a different number. This means that there is an order in the resulting categories (e.g. 0 < 1 < 2). If a categorical variable does not carry any meaningful order information then this encoding might be misleading to downstream statistical models and you might consider using one-hot encoding instead (see below).\n\n## Encoding nominal categories (without assuming any order)\n\nOne-hot encoding is an alternative encoder that prevents the downstream models to make a false assumption about the ordering of categories. For a given feature, it will create as many new columns as there are possible categories. For a given sample, the value of the column corresponding to the category will be set to 1 while all the columns of the other categories will be set to 0.\n\nWe see that encoding a single feature will give a table full of zeros and ones. Sparse matrices are efficient data structures when most of your matrix elements are zero. If you want more details about them, you can look at this. (https://scipy-lectures.org/advanced/scipy_sparse/introduction.html#why-sparse-matrices)\n\n## Choosing an encoding strategy\n\nChoosing an encoding strategy will depend on the underlying models and the type of categories (i.e. ordinal vs. nominal).\n\nIn general One-Hot encoding is the encoding strategy used when the downstream models are linear models while ordinal encoding is often a good strategy with tree-based models. Using an OrdinalEncoder will output ordinal categories.The impact of violating this ordering assumption is really dependent on the downstream models. Linear models will be impacted by misordered categories while tree-based models will not. One-hot encoding categorical variables with high cardinality can cause computational inefficiency in tree-based models. Because of this, it is not recommended to use OneHotEncoder in such cases even if the original categories do not have a given order.\n\nYou can still use an ordinall encoding with linear models but you need to be sure that:\n\n* the original categories (before encoding) have an ordering;\n* the encoded categories follow the same ordering than the original categories.",
    "supporting": [
      "categorical_data_encoding_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{},\"value\":[]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}