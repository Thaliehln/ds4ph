---
title: ":orange_book: Encode categorical data"
execute: 
  echo: true
  warning: false
---

# Introduction

## Overview

Most ML algorithms only work with numeric values
In this notebook, we will present typical ways of dealing with categorical variables by encoding them, namely ordinal encoding and one-hot encoding.

## Learning objectives

* seen two common strategies for encoding categorical features: ordinal encoding and one-hot encoding;
* used a pipeline to use a one-hot encoder before fitting a logistic regression.

```{r}
#| echo: fenced
library(dplyr)
library(skimr)
```

## Identify categorical data

Letâ€™s first load the entire adult dataset containing both numerical and categorical data.

```{r}
#| echo: fenced
df <- openxlsx::read.xlsx("./data/dataset2.xlsx")
```

::: panel-tabset
#### :pencil2: Exercise 1

Examine the structure of the data, including variable names, labels.

::: callout-tip
-   Stata: use the [codebook](https://www.stata.com/manuals/dcodebook.pdf) command
-   R: use the [skim](https://docs.ropensci.org/skimr/reference/skim.html) function from the `skimr` package
:::

```{r}
#| echo: fenced
# Write your code here
```

#### R

```{r}
#| echo: fenced
df %>%
  skimr::skim()
```
:::

## Ordinal encoding

The most intuitive strategy is to encode each category with a different number. This means that there is an order in the resulting categories (e.g. 0 < 1 < 2). If a categorical variable does not carry any meaningful order information then this encoding might be misleading to downstream statistical models and you might consider using one-hot encoding instead (see below).

## Encoding nominal categories (without assuming any order)

One-hot encoding is an alternative encoder that prevents the downstream models to make a false assumption about the ordering of categories. For a given feature, it will create as many new columns as there are possible categories. For a given sample, the value of the column corresponding to the category will be set to 1 while all the columns of the other categories will be set to 0.

We see that encoding a single feature will give a table full of zeros and ones. Sparse matrices are efficient data structures when most of your matrix elements are zero. If you want more details about them, you can look at this. (https://scipy-lectures.org/advanced/scipy_sparse/introduction.html#why-sparse-matrices)

## Choosing an encoding strategy

Choosing an encoding strategy will depend on the underlying models and the type of categories (i.e. ordinal vs. nominal).

In general One-Hot encoding is the encoding strategy used when the downstream models are linear models while ordinal encoding is often a good strategy with tree-based models. Using an OrdinalEncoder will output ordinal categories.The impact of violating this ordering assumption is really dependent on the downstream models. Linear models will be impacted by misordered categories while tree-based models will not. One-hot encoding categorical variables with high cardinality can cause computational inefficiency in tree-based models. Because of this, it is not recommended to use OneHotEncoder in such cases even if the original categories do not have a given order.

You can still use an ordinall encoding with linear models but you need to be sure that:

* the original categories (before encoding) have an ordering;
* the encoded categories follow the same ordering than the original categories.